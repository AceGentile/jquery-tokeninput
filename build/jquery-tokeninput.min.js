/*! jquery-tokeninput 2014-02-16 */
!function(a){function b(a){return String(null===a||void 0===a?"":a)}function c(a){return b(a).replace(d,function(a){return i[a]})}var d,e,f,g,h,d,i,j,k,l,m,n,o=[],p=0;e={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&#215;",animateDropdown:!0,placeholder:null,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(a){var b=a[this.propertyToSearch];return"<li>"+(this.enableHTML?b:c(b))+"</li>"},tokenFormatter:function(a){var b=a[this.propertyToSearch];return"<li><p>"+(this.enableHTML?b:c(b))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,onSelectFirstResult:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},f={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},g={BEFORE:0,AFTER:1,END:2},h={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},d=/[&<>"'\/]/g,i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},k={init:function(b,c){var d=a.extend({},e,c||{});return this.each(function(){a(this).data("settings",d),a(this).data("tokenInputObject",new a.TokenList(this,b,d))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(a){return this.data("tokenInputObject").add(a),this},remove:function(a){return this.data("tokenInputObject").remove(a),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(a){return this.data("tokenInputObject").toggleDisabled(a),this},setOptions:function(b){return a(this).data("settings",a.extend({},a(this).data("settings"),b||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var a=this,b=this.parent();return b.empty(),a.show(),b.append(a),a}}},a.fn.tokenInput=function(a){return k[a]?k[a].apply(this,Array.prototype.slice.call(arguments,1)):k.init.apply(this,arguments)},a.TokenList=function(b,d,e){function i(a){return j.enableHTML?a:c(a)}function k(b){j.disabled="boolean"==typeof b?b:!j.disabled,P.attr("disabled",j.disabled),U.toggleClass(j.classes.disabled,j.disabled),R&&w(a(R),g.END),Q.attr("disabled",j.disabled)}function q(){return null!==j.tokenLimit&&p>=j.tokenLimit?(P.hide(),void A()):void 0}function r(){if(n!==(n=P.val())){var a=U.width()-P.offset().left-U.offset().left;X.html(c(n)||c(e.placeholder)),P.width(Math.min(U.width(),Math.max(a,X.width()+30)))}}function s(){var b=a.trim(P.val()),c=b.split(j.tokenDelimiter);a.each(c,function(b,c){if(c){a.isFunction(j.onFreeTaggingAdd)&&(c=j.onFreeTaggingAdd.call(Q,c));var d={};d[j.tokenValue]=d[j.propertyToSearch]=c,u(d)}})}function t(b){var c=a(j.tokenFormatter(b)),d=b.readonly===!0?!0:!1;d&&c.addClass(j.classes.tokenReadOnly),c.addClass(j.classes.token).insertBefore(V),d||a("<span>"+j.deleteText+"</span>").addClass(j.classes.tokenDelete).appendTo(c).click(function(){return j.disabled?void 0:(y(a(this).parent()),Q.change(),!1)});var e=b;return a.data(c.get(0),"tokeninput",b),o=o.slice(0,S).concat([e]).concat(o.slice(S)),S++,z(o,Q),p+=1,null!==j.tokenLimit&&p>=j.tokenLimit&&(P.hide(),A()),c}function u(b){var c=j.onAdd;if(p>0&&j.preventDuplicates){var d=null;if(U.children().each(function(){var c=a(this),f=a.data(c.get(0),"tokeninput");return f&&f[e.tokenValue]===b[e.tokenValue]?(d=c,!1):void 0}),d)return v(d),V.insertAfter(d),void N(P)}P.width(0),(null==j.tokenLimit||p<j.tokenLimit)&&(t(b),P.attr("placeholder",null),q()),P.val(""),A(),a.isFunction(c)&&c.call(Q,b)}function v(a){j.disabled||(a.addClass(j.classes.selectedToken),R=a.get(0),P.val(""),A())}function w(a,b){a.removeClass(j.classes.selectedToken),R=null,b===g.BEFORE?(V.insertBefore(a),S--):b===g.AFTER?(V.insertAfter(a),S++):(V.appendTo(U),S=p),N(P)}function x(b){var c=R;R&&w(a(R),g.END),c===b.get(0)?w(b,g.END):v(b)}function y(b){var c=a.data(b.get(0),"tokeninput"),d=j.onDelete,f=b.prevAll().length;f>S&&f--,b.remove(),R=null,N(P),o=o.slice(0,f).concat(o.slice(f+1)),0==o.length&&P.attr("placeholder",e.placeholder),S>f&&S--,z(o,Q),p-=1,null!==j.tokenLimit&&(P.show().val(""),N(P)),"function"==typeof d&&d.call(Q,c)}function z(b,c){var d=a.map(b,function(a){return"function"==typeof j.tokenValue?j.tokenValue.call(this,a):a[j.tokenValue]});c.val(d.join(j.tokenDelimiter))}function A(){W.hide().empty(),T=null}function B(){W.css({position:"absolute",top:U.offset().top+U.outerHeight(),left:U.offset().left,width:U.width(),"z-index":j.zindex}).show()}function C(){j.searchingText&&(W.html("<p>"+i(j.searchingText)+"</p>"),B())}function D(){j.hintText&&(W.html("<p>"+i(j.hintText)+"</p>"),B())}function E(a){return a.replace(Z,"\\$&")}function F(a,b){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(b)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(a,b){return"<b>"+i(b)+"</b>"})}function G(a,b,c){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(b)+")(?![^<>]*>)(?![^&;]+;)","g"),F(b,c))}function H(b,c){if(c&&c.length){W.empty();var d=a("<ul/>").appendTo(W);d.on("mouseover",function(b){I(a(b.target).closest("li"))}),d.on("mousedown",function(b){return u(a(b.target).closest("li").data("tokeninput")),Q.change(),!1}),d.hide(),j.resultsLimit&&c.length>j.resultsLimit&&(c=c.slice(0,j.resultsLimit)),a.each(c,function(c,e){var f=j.resultsFormatter(e);f=G(f,e[j.propertyToSearch],b),f=a(f).appendTo(d),f.addClass(c%2?j.classes.dropdownItem:j.classes.dropdownItem2),0===c&&j.onSelectFirstResult&&I(f),a.data(f.get(0),"tokeninput",e)}),B(),j.animateDropdown?d.slideDown("fast"):d.show()}else j.noResultsText&&(W.html("<p>"+i(j.noResultsText)+"</p>"),B())}function I(b){b&&(T&&J(a(T)),b.addClass(j.classes.selectedDropdownItem),T=b.get(0))}function J(a){a.removeClass(j.classes.selectedDropdownItem),T=null}function K(){var b=P.val();b&&b.length&&(R&&w(a(R),g.AFTER),b.length>=j.minChars?(C(),clearTimeout(m),m=setTimeout(function(){L(b)},j.searchDelay)):A())}function L(b){var c=b+M(),d=l.get(c);if(d)"function"==typeof j.onCachedResult&&(d=j.onCachedResult.call(Q,d)),H(b,d);else if(j.url){var f=M(),g={};if(g.data={},f.indexOf("?")>-1){var h=f.split("?");g.url=h[0];var i=h[1].split("&");a.each(i,function(a,b){var c=b.split("=");g.data[c[0]]=c[1]})}else g.url=f;g.data[j.queryParam]=b,g.type=j.method,g.dataType=j.contentType,j.crossDomain&&(g.dataType="jsonp"),g.success=function(a){l.add(c,j.jsonContainer?a[j.jsonContainer]:a),"function"==typeof j.onResult&&(a=j.onResult.call(Q,a)),P.val()===b&&H(b,j.jsonContainer?a[j.jsonContainer]:a)},e.onSend&&e.onSend(g),a.ajax(g)}else if(j.local_data){var k=a.grep(j.local_data,function(a){return a[j.propertyToSearch].toLowerCase().indexOf(b.toLowerCase())>-1});l.add(c,k),"function"==typeof j.onResult&&(k=j.onResult.call(Q,k)),H(b,k)}}function M(){var a=j.url;return"function"==typeof j.url&&(a=j.url.call(j)),a}function N(a){setTimeout(function(){a.focus()},50)}if(j=a(b).data("settings"),"string"==typeof d||"function"==typeof d){j.url=d;var O=M();void 0===j.crossDomain&&"string"==typeof O&&(j.crossDomain=-1===O.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==O.split(/\/+/g)[1])}else"object"==typeof d&&(j.local_data=d);j.classes?j.classes=a.extend({},f,j.classes):j.theme?(j.classes={},a.each(f,function(a,b){j.classes[a]=b+"-"+j.theme})):j.classes=f,l=new a.TokenList.Cache;var P=a('<input type="text"  autocomplete="off" autocapitalize="off"/>').css({outline:"none"}).attr("id",j.idPrefix+b.id).focus(function(){return j.disabled?!1:((null===j.tokenLimit||j.tokenLimit!==p)&&D(),void U.addClass(j.classes.focused))}).on("blur",function(b){var c=a(b.target);A(),j.allowFreeTagging&&s(),c.val(""),U.removeClass(j.classes.focused)}).bind("keyup keydown blur update",r).on("keydown",function(b){var c,d,e=a(b.target);switch(b.keyCode){case h.LEFT:case h.RIGHT:case h.UP:case h.DOWN:if(0===e.val().length)c=V.prev(),d=V.next(),c.length&&c.get(0)===R||d.length&&d.get(0)===R?b.keyCode===h.LEFT||b.keyCode===h.UP?w(a(R),g.BEFORE):w(a(R),g.AFTER):b.keyCode!==h.LEFT&&b.keyCode!==h.UP||!c.length?b.keyCode!==h.RIGHT&&b.keyCode!==h.DOWN||!d.length||v(a(d.get(0))):v(a(c.get(0)));else{var f=null;b.keyCode===h.DOWN||b.keyCode===h.RIGHT?(f=a(W).find("li").first(),T&&(f=a(T).next())):(f=a(W).find("li").last(),T&&(f=a(T).prev())),f&&I(f)}break;case h.BACKSPACE:if(c=V.prev(),0===e.val().length)return R?(y(a(R)),Q.change()):c.length&&v(a(c.get(0))),!1;1===e.val().length?A():setTimeout(function(){K()},5);break;case h.TAB:case h.ENTER:case h.NUMPAD_ENTER:case h.COMMA:if(T)u(a(T).data("tokeninput")),Q.change();else{if(j.allowFreeTagging){if(j.allowTabOut&&""===a(this).val())return!0;s()}else if(a(this).val(""),j.allowTabOut)return!0;b.stopPropagation(),b.preventDefault()}return!1;case h.ESCAPE:return A(),!0;default:String.fromCharCode(b.which)&&setTimeout(function(){K()},5)}});e.placeholder&&P.attr("placeholder",e.placeholder);var Q=a(b).hide().val("");Q.on("focus",function(){N(P)}).on("blur",function(){return P.blur(),Q});var R=null,S=0,T=null,U=a("<ul />").addClass(j.classes.tokenList).on("click",function(b){var c=a(b.target).closest("li");c&&c.get(0)&&a.data(c.get(0),"tokeninput")?x(c):(R&&w(a(R),g.END),N(P))}).on("mouseover",function(b){var c=a(b.target).closest("li");c&&R!==this&&c.addClass(j.classes.highlightedToken)}).on("mouseout",function(b){var c=a(b.target).closest("li");c&&R!==this&&c.removeClass(j.classes.highlightedToken)}).insertBefore(Q),V=a("<li />").addClass(j.classes.inputToken).appendTo(U).append(P),W=a("<div/>").addClass(j.classes.dropdown).appendTo("body").hide(),X=a("<tester/>").insertAfter(P).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:P.css("fontSize"),fontFamily:P.css("fontFamily"),fontWeight:P.css("fontWeight"),letterSpacing:P.css("letterSpacing"),whiteSpace:"nowrap"});Q.val("");var Y=j.prePopulate||Q.data("pre");j.processPrePopulate&&a.isFunction(j.onResult)&&(Y=j.onResult.call(Q,Y)),Y&&Y.length&&a.each(Y,function(a,b){t(b),q(),P.attr("placeholder",null)}),j.disabled&&k(!0),a.isFunction(j.onReady)&&j.onReady.call(),this.clear=function(){U.children("li").each(function(){0===a(this).children("input").length&&y(a(this))})},this.add=function(a){u(a)},this.remove=function(b){U.children("li").each(function(){if(0===a(this).children("input").length){var c=a(this).data("tokeninput"),d=!0;for(var e in b)if(b[e]!==c[e]){d=!1;break}d&&y(a(this))}})},this.getTokens=function(){return o},this.toggleDisabled=function(a){k(a)},r();var Z=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},a.TokenList.Cache=function(b){var c=a.extend({max_size:500},b),d={},e=0,f=function(){d={},e=0};this.add=function(a,b){e>c.max_size&&f(),d[a]||(e+=1),d[a]=b},this.get=function(a){return d[a]}}}(jQuery);